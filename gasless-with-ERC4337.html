<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-gasless-with-ERC4337">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">How Godwoken experiments gasless transaction using simplified ERC-4337 proposal | Godwoken Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.godwoken.io/gasless-with-ERC4337"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How Godwoken experiments gasless transaction using simplified ERC-4337 proposal | Godwoken Docs"><meta data-rh="true" name="description" content="This post is supposed to introduce our recent works about bringing a gasless-transaction feature on Godwoken, the generic optimistic roll-up solution built on the CKB network. It covers the basic principle and details about how the gasless feature works based on simplified ERC-4337 specs. We would also love to treat it as an opportunity to discuss the pros and cons of such a model with the most intelligent readers in crypto."><meta data-rh="true" property="og:description" content="This post is supposed to introduce our recent works about bringing a gasless-transaction feature on Godwoken, the generic optimistic roll-up solution built on the CKB network. It covers the basic principle and details about how the gasless feature works based on simplified ERC-4337 specs. We would also love to treat it as an opportunity to discuss the pros and cons of such a model with the most intelligent readers in crypto."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.godwoken.io/gasless-with-ERC4337"><link data-rh="true" rel="alternate" href="https://docs.godwoken.io/gasless-with-ERC4337" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.godwoken.io/gasless-with-ERC4337" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://W0P1A076NN-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-215912231-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Godwoken Docs" href="/opensearch.xml">
<link rel="preconnect" href="https://cryptapeblog.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://cryptapeblog.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","2"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.4ef8b86f.css">
<link rel="preload" href="/assets/js/runtime~main.b9cc5c35.js" as="script">
<link rel="preload" href="/assets/js/main.fa05ee6b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Godwoken Docs</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/">Latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/gasless-with-ERC4337">Latest</a></li><li><a class="dropdown__link" href="/1.6">1.6</a></li><li><a class="dropdown__link" href="/1.5">1.5</a></li><li><a class="dropdown__link" href="/1.4">1.4</a></li><li><a class="dropdown__link" href="/1.3-rc1">1.3-rc1</a></li><li><a class="dropdown__link" href="/1.2-rc1">1.2-rc1</a></li><li><a class="dropdown__link" href="/1.1">1.1</a></li><li><a class="dropdown__link" href="/0.10.4">0.10.4</a></li></ul></div><a href="https://github.com/godwokenrises/godwoken" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://discord.gg/TfC9rExfHh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS darkNavbarColorModeToggle_X3D1" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--dark_i4oU"><b>Godwoken Docs</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Get Started with Godwoken</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickStart">Developer Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview">Godwoken Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/connectionInfo">Godwoken Public Networks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/frameworks">Basic Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/frameworks">Frameworks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/infrastructure">Infrastructure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/standards">Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/structure">Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tooling">Tooling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/wallets">Wallets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tokens">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gwtxLife">Godwoken Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gwScripts">Scripts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pCKB">pCKB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/depAndWthd">Deposit and Withdrawal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/godwokenkicker">Godwoken-Kicker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/account-faucet">Account-Faucet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gasless-feature">Gasless Feature</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gasless-with-ERC4337">How Godwoken experiments gasless transaction using simplified ERC-4337 proposal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/debug-replay-rpc">Debug a transaction via RPC</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/integration">Dapp Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/purchaseCKB">Asset Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/gwchangelog/v0difv1">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/covalent">Ecosystem Tools</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reference">Reference and Useful Links</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Basic Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How Godwoken experiments gasless transaction using simplified ERC-4337 proposal</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Latest</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How Godwoken experiments gasless transaction using simplified ERC-4337 proposal</h1></header><p>This post is supposed to introduce our recent works about bringing a gasless-transaction feature on Godwoken, the generic optimistic roll-up solution built on the CKB network. It covers the basic principle and details about how the gasless feature works based on simplified ERC-4337 specs. We would also love to treat it as an opportunity to discuss the pros and cons of such a model with the most intelligent readers in crypto.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="basic-idea">Basic Idea<a href="#basic-idea" class="hash-link" aria-label="Direct link to Basic Idea" title="Direct link to Basic Idea">​</a></h2><p>Since layer2 is an extended network for the underlying layer1 blockchain, it serves as an ambition to embrace mainstream users, in which most of them are new to the crypto world and hard to onboard, due to the gas problem:</p><ol><li>you need to understand how gas works to send a transaction, while most internet services we are using today are free of charge and easy to pay.</li><li>you need to have some cryptocurrencies in your wallet before you can pay for the gas to do anything on-chain.</li></ol><p>When most users are on their first time onboard, they are often stuck at these two problems at the same time. On the other hand, some developers are eager to gain new users, they are willing to pay gas fees for users to use their product or play their blockchain games. There just doesn&#x27;t exist an easy way to do that.
The basic idea of the gasless transaction is to allow users to send free-charged transactions so they can freely use the on-chain application first and then charge back from the application the transaction interacts with. In another way, the application is sponsoring the user&#x27;s transaction so users don&#x27;t need to pay for themselves.
For Godwoken to do that, we need to solve two problems:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-let-users-submit-free-charged-transactions">How to let users submit free-charged transactions<a href="#how-to-let-users-submit-free-charged-transactions" class="hash-link" aria-label="Direct link to How to let users submit free-charged transactions" title="Direct link to How to let users submit free-charged transactions">​</a></h2><p>The transaction fee in EVM-equivalent blockchains is charged based on the gas price and the total gas used by this transaction. EIP-1559 gives a more complex model about this but since that&#x27;s out of topic for this post, we will not touch it here.</p><blockquote><p>gas_fee = gas_price * gas_used</p></blockquote><ul><li>the gas used is determined by what the transaction is doing (e.g. How much space it writes to the blockchain? Does it consume a lot of CPU to process computation?).</li><li>the gas price is determined by how much you are willing to bid the block_producer to pack your transaction ASAP.</li></ul><p>This mechanism works like a bidding marketplace for transaction fees. The block_producer sorts the transaction by gas price from high to low, then pack the first transaction from the top down in order to make it a profitable business.
Normally when the gas price is set to 0, the transaction won&#x27;t be accepted by block_producer, since it takes the cost for the block producer to execute the transaction and included it into a new block.
Our gasless feature uses 0 gas price as a unique marker to allow users to submit gasless transactions. It is intuitive from the user’s point of view and more importantly, it only takes little work to change the code in Godwoken mem-pool implementation.
With the gasless feature enabled, when Godwoken block_producer sees a transaction with 0 gas price, they will first check if the transaction is a valid gasless transaction, if it is, the block producer will reveal the real gas price (the sponsoring gas price) from this transaction, and sort the transaction in the mem-pool according to this real price, the rest work just becomes the same with normal transactions.
But How does one transaction with 0 gas price become a valid gasless transaction? This brings us to the second problem:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-charge-the-application-for-sponsoring-transactions">How to charge the application for sponsoring transactions<a href="#how-to-charge-the-application-for-sponsoring-transactions" class="hash-link" aria-label="Direct link to How to charge the application for sponsoring transactions" title="Direct link to How to charge the application for sponsoring transactions">​</a></h2><p>In order to charge the application that sponsors the gasless transactions, the application developer must pre-deposit some funds and the application must have the ability to automatically check if they are willing to sponsor one specific transaction. If it does, it should then automatically transfer the transaction fee to the block producer who packs the transaction.
The Galsess feature encodes those logics into 2 EVM smart contracts and uses them to handle the process. They are called Paymaster and Entrypoint.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-paymaster">1. Paymaster<a href="#1-paymaster" class="hash-link" aria-label="Direct link to 1. Paymaster" title="Direct link to 1. Paymaster">​</a></h3><p>This contract is supposed to be written and controlled by application developers.
It must have some pre-deposit funds to pay the gas fee for sponsoring gasless transactions. it is also in charge of validating if the transaction meets some specific requirements for sponsoring.
For example, the paymaster can encode some mature ideas from traditional industries about how to onboard new users.
One validating logic can be Youtube&#x27;s one-month free premium trial. The paymaster could check the block timestamp to reject sponsoring those users who have passed the expired time.
Another example might be a blockchain gaming dApp that decides every new user will have the first 100 transactions fee-free. When the user sends the 101st transaction, the paymaster will stop sponsoring the gas fee.
You can even have an interesting idea to leverage the gasless feature to let users pay the gas fee with non-native tokens. Say, one transaction can be sponsored only if the user owns some NFTs or some tokens you issued.
These ideas can also combine with some basic whitelist mechanisms. For example, when a user reaches a certain level, his/her public key will automatically join into the paymaster’s whitelist. And then the sponsoring premium will be unlocked for him/her.
The idea here is to make application developers focus on their needs while having the flexibility to set rules for sponsoring to do whatever they want.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-entrypoint">2. Entrypoint<a href="#2-entrypoint" class="hash-link" aria-label="Direct link to 2. Entrypoint" title="Direct link to 2. Entrypoint">​</a></h3><p>This contract is supposed to be deployed by the Godwoken network and must be owned by no one.</p><p>The entrypoint contract contains 3 parts:</p><ul><li><strong>managing fund pool</strong>: In order to let Paymaster pre-deposit funds, Entrypoint also acts as a fund pool. When a paymaster transfer tokens to Entrypoint, Entrypoint records every paymaster&#x27;s deposit balance. Entrypoint also has the ability to move the funds to block_producer after confirming that the paymaster is willing to sponsor the gas fee.</li><li><strong>validating and executing</strong>: Check if the paymaster is willing to sponsor one specific transaction, this involves calling the paymaster contract to get the validating result. If the result is good, Entrypoint is also responsible for actually executing this transaction, the execution is often related to some business logic of the application.</li><li><strong>calculating and transferring</strong>: After executing the transaction, Entrypoint will calculate how much gas fee the transaction costs, and take the corresponding cost from the paymaster balance (deposited in Entrypoint fund pool, remember?) to the block producer.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h3><p>When a user signs a gasless transaction, the transaction is not only with 0 gas price but also supposed to call Entrypoint contract with a call data explaining what they really want to do. That call data uses a data structure named <code>UserOperation</code> and it contains information like the real gas price that the sponsor will pay, the paymaster contract address, the real target contract that the user is calling, etc.</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct UserOperation {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address callContract;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes   callData;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 callGasLimit;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 verificationGasLimit;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 preVerificationGas;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 maxFeePerGas;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 maxPriorityFeePerGas;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes   paymasterAndData;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Entrypoint will take this <code>UserOperation</code> call data to call the paymaster contract to validate if such a sponsor transaction is legal. If it is, Entrypoint will charge the gas fee and execute the transaction. If it is not, the transaction should be reverted.
More details about how the Godwoken full-node assumes a transaction is a gasless transaction:</p><ol><li><code>tx.gasPrice</code> must be <code>0</code>.</li><li><code>tx.data</code> must be a valid <code>UserOperation</code>. </li><li><code>tx.gas</code> must equal to <strong>UserOperation.callGasLimit + UserOperation.verificationGasLimit * 3</strong>.</li><li><code>tx.to</code> must equal to <code>EntryPoint</code>&#x27;s address.</li><li><code>UserOperation.paymasterAndData</code> must contain a valid paymaster address.</li></ol><p>With users able to send free-charge transactions and block_producer able to receive funds from sponsor dApps, we can finally bring a gasless transaction experience to mainstream users.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="difference-between-gasless-feature-and-erc-4337">Difference between Gasless feature and ERC-4337<a href="#difference-between-gasless-feature-and-erc-4337" class="hash-link" aria-label="Direct link to Difference between Gasless feature and ERC-4337" title="Direct link to Difference between Gasless feature and ERC-4337">​</a></h3><p>For those who are familiar with ERC-4337 proposal, you might already find entrypoint and paymaster contracts quite ring a bell. In fact, the gasless feature is intended to use a simplified version of ERC-4337 specs.
The main difference is that ERC-4337 is also an account abstraction focus, which is to make mainstream users get rid of private keys and mnemonic stuff. You might often hear this as &quot;smart-contract wallet&quot;. </p><p>In a high-level explanation, </p><blockquote><p>ERC-4337 = seedless feature + gasless feature</p></blockquote><p>While in Godwoken, we only do the last half of it. We believe it is a better choice for Godwoken to abort the seedless idea in the current phase, due to many reasons:</p><ul><li>ERC-4337 is still in the protocol design phase, it is not widely accepted by the community. It might take a while before it makes a real influence in the crypto industry. However, we want the users and developers to enjoy the gasless feature today.</li><li>Godwoken is focused on infrastructure while ERC-4337 is apparently an application-level business. The way Godwoken chooses to implement the gasless feature is more like an optional API, it doesn’t conflicts with the application developers who might wish to pursue a smart wallet opportunity when ERC-4337 is ready in the future.</li><li>ERC-4337 is very flexible and brings more complexity thus making it unrealistic to safely use in the production stage right now.</li><li>There is a gap between smart contract wallets and key-based wallets. Most users today are still using key-based wallets.</li><li>Since Godwoken is built on the UTXO model of the CKB blockchain, there is a lot of space to explore account abstraction ideas, and it might not happen on the EVM-compatible level.</li></ul><p>The seedless vision of ERC-4337 introduces a lot of complex details and involves different ecosystem actors in order to make it work. To implement account abstraction, ERC-4337 makes the user sign <code>UserOperation</code> call data and sends them to a separate mem-pool, A special class of actor called bundlers (either block builders, or users that can send transactions to block builders through a bundle marketplace) package up a set of these objects into a transaction making a special calling to <code>Entrypoint</code>, and that transaction then gets included in a block.
Godwoken inherent the <code>UserOperation</code> idea from ERC-4337 but exclude the complexity part of account abstraction. The gasless feature allows the user to sign a transaction with 0 gas price to call entrypoint contract with <code>UserOperation</code> call data. Since the user is still signing a transaction instead of a <code>UserOperation</code> call data, we don&#x27;t need a separate mem-pool to handle different kinds of requests. Therefore we don&#x27;t need the role of bundlers either. The block_producer is naturally the bundler who packs the gasless transaction into a new block.
More clear differences can be found in the details of <code>UserOperation</code> structure changes:</p><div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct UserOperation {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-        address sender;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-        uint256 nonce;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-        bytes   initCode;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+        address callContract;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         bytes   callData;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         uint256 callGasLimit;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         uint256 verificationGasLimit;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         uint256 preVerificationGas;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         uint256 maxFeePerGas;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         uint256 maxPriorityFeePerGas;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         bytes   paymasterAndData;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-        bytes   signature;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Account-related schemes like signature/nonce/sender address are removed since users are using the original key-based wallet. By having less functionality, we retain less complexity with fewer parties involved required, making it a more practical solution to move quickly and iterate fastly as a feature experimentation.
Some other differences:</p><ul><li>Bundlers in ERC-4337 can pack a batch of UserOperations into one single transaction. While in Godwoken, one UserOperation is mapped to one transaction.</li><li>It is actually very hard to calculate precisely how much the gas fee that one transaction costs. ERC-4337 uses <code>preVerificationGas</code> to let bundlers adjust the cost differences. In gasless transaction, Godwoken block_producer must check if the <code>preVerificationGas</code> is large enough that the total calculation covers the gas fee cost.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>In this post, we introduced our recent experiments for the Godwoken gasless feature based on simplified ERC-4337 specs. In general, the ERC-4337 is more flexible and ambitious about the seedless and gasless abilities, while the Godwoken gasless feature is focused on a more practical and simpler dedicated solution to improve layer2’s usability while keeping the ecosystem opened and not conflict with smart wallet developers to work on ERC-4337 solutions.</p><p>If you want to dive into gasless feture with a demo, please continue with <a href="/gasless-feature">Gasless Feature</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/gasless-feature"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Gasless Feature</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/debug-replay-rpc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Debug a transaction via RPC</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-idea" class="table-of-contents__link toc-highlight">Basic Idea</a></li><li><a href="#how-to-let-users-submit-free-charged-transactions" class="table-of-contents__link toc-highlight">How to let users submit free-charged transactions</a></li><li><a href="#how-to-charge-the-application-for-sponsoring-transactions" class="table-of-contents__link toc-highlight">How to charge the application for sponsoring transactions</a><ul><li><a href="#1-paymaster" class="table-of-contents__link toc-highlight">1. Paymaster</a></li><li><a href="#2-entrypoint" class="table-of-contents__link toc-highlight">2. Entrypoint</a></li><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li><li><a href="#difference-between-gasless-feature-and-erc-4337" class="table-of-contents__link toc-highlight">Difference between Gasless feature and ERC-4337</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Godwoken. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b9cc5c35.js"></script>
<script src="/assets/js/main.fa05ee6b.js"></script>
</body>
</html>